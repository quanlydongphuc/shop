<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω B√°n ƒê·ªìng Ph·ª•c</title>
    <style>
        /* === PH·∫¶N CSS === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', Times, serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }

        /* Header v√† Navigation */
        .app-header {
            background: #2c3e50;
            color: white;
            padding: 15px 0;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .app-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .main-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            font-weight: bold;
        }

        .nav-btn:hover {
            background: #1abc9c;
        }

        .nav-btn.active {
            background: #1abc9c;
        }

        /* Dashboard Header */
        .dashboard-header {
            display: flex;
            gap: 15px;
            padding: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .total-card {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            flex: 1;
            text-align: center;
        }

        .total-card h3 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #555;
        }

        .amount {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            color: #222;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .menu-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .menu-section.active {
            display: block;
        }

        .section-title {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #1abc9c;
            padding-bottom: 5px;
        }

        /* Menu B√°n H√†ng */
        .container {
            display: flex;
            gap: 15px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            flex: 3;
        }

        .product-item {
            height: 80px;
            border: 1px solid;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            padding: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .product-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .product-nam { 
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
            color: #3b82f6;
        }

        .product-nu { 
            border-color: #f472b6;
            background: rgba(244, 114, 182, 0.05);
            color: #f472b6;
        }

        .product-the-duc {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
            color: #d97706;
        }

        .product-stock {
            font-size: 11px;
            margin-top: 3px;
            font-weight: normal;
        }

        .cart-section {
            flex: 1;
            min-width: 280px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            height: fit-content;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }

        .cart-items {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        .cart-footer {
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        /* Menu Gi√° B√°n */
        .price-management {
            display: flex;
            gap: 20px;
        }

        .price-form {
            flex: 1;
        }

        .price-history {
            flex: 1;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 500px;
            overflow-y: auto;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .price-table th, .price-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .price-table th {
            background: #f1f1f1;
        }

        .price-input {
            width: 100px;
            padding: 5px;
            text-align: center;
        }

        .history-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        /* Menu Nh·∫≠p H√†ng & T·ªìn Kho */
        .import-form, .inventory-table {
            margin-bottom: 20px;
        }

        .import-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .import-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .import-input {
            width: 80px;
            padding: 5px;
            text-align: center;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th {
            background: #2c3e50;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }

        .data-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        .data-table td[style*="vertical-align: middle"] {
            background: #e8f4f8 !important;
            font-weight: bold;
            color: #2c3e50;
        }

        /* Modal - ƒê√É C·∫¢I THI·ªÜN */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 380px;
            max-width: 90vw;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #1abc9c;
            box-shadow: 0 0 0 2px rgba(26, 188, 156, 0.2);
        }

        .form-textarea {
            resize: vertical;
            min-height: 60px;
        }

        .error-message {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-primary {
            background: #1abc9c;
            color: white;
        }

        .btn-primary:hover {
            background: #16a085;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .cart-header .btn-danger {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .cart-header .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        /* T·ªïng quan */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .overview-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .overview-card h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .overview-value {
            font-size: 24px;
            font-weight: bold;
            color: #1abc9c;
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 1024px) {
            .products-grid, .import-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .container, .price-management {
                gap: 10px;
            }
            
            .product-item {
                height: 70px;
                font-size: 12px;
            }
            
            .cart-section {
                min-width: 250px;
            }
            
            .data-table {
                font-size: 12px;
            }
            
            .data-table th, .data-table td {
                padding: 6px;
            }
            
            .overview-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .container, .price-management {
                flex-direction: column;
            }
            
            .products-grid, .import-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }
            
            .product-item {
                height: 60px;
                font-size: 11px;
            }
            
            .cart-section {
                min-width: 100%;
                margin-top: 15px;
            }
            
            .main-nav {
                flex-direction: column;
                gap: 5px;
            }
            
            .nav-btn {
                width: 100%;
                text-align: center;
            }
            
            .data-table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .data-table {
                min-width: 600px;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 10px;
            }
            
            .menu-section {
                padding: 15px;
            }
            
            .products-grid, .import-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .product-item {
                height: 55px;
                font-size: 10px;
            }
            
            .product-stock {
                font-size: 9px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .data-table th, .data-table td {
                padding: 4px;
                font-size: 10px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            .total-card {
                padding: 10px;
            }
            
            .amount {
                font-size: 16px;
            }
        }

        /* N√∫t x√≥a t·∫•t c·∫£ */
        .delete-all-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            display: inline-block;
        }

        .delete-all-btn:hover {
            background: #c0392b;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .section-title {
            margin-bottom: 0;
            flex: 1;
        }

        /* Th√¥ng b√°o */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease-in-out;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.info {
            background: #3498db;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="nav-container">
            <h1 class="app-title">H·ªÜ TH·ªêNG QU·∫¢N L√ù B√ÅN ƒê·ªíNG PH·ª§C</h1>
            <nav class="main-nav">
                <button class="nav-btn active" onclick="showMenu('tong-quan')">T·ªïng Quan</button>
                <button class="nav-btn" onclick="showMenu('gia-ban')">Gi√° B√°n</button>
                <button class="nav-btn" onclick="showMenu('nhap-hang')">Nh·∫≠p H√†ng</button>
                <button class="nav-btn" onclick="showMenu('ban-hang')">B√°n H√†ng</button>
                <button class="nav-btn" onclick="showMenu('ton-kho')">T·ªìn Kho</button>
                <button class="nav-btn" onclick="showMenu('lich-su-nhap')">L·ªãch S·ª≠ Nh·∫≠p</button>
                <button class="nav-btn" onclick="showMenu('lich-su-ban')">L·ªãch S·ª≠ B√°n</button>
            </nav>
        </div>
    </header>

    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="total-card">
            <h3>üì¶ T·ªïng gi√° tr·ªã t·ªìn kho</h3>
            <p class="amount" id="total-inventory-value">0 ‚Ç´</p>
        </div>
        <div class="total-card">
            <h3>üí∞ T·ªïng gi√° tr·ªã b√°n</h3>
            <p class="amount" id="total-sales-value">0 ‚Ç´</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Menu T·ªïng Quan -->
        <section id="tong-quan" class="menu-section active">
            <h2 class="section-title">üìà T·ªîNG QUAN</h2>
            <div class="overview-grid" id="overview-stats">
                <div class="overview-card">
                    <h3>T·ªïng s·ªë s·∫£n ph·∫©m t·ªìn kho</h3>
                    <div class="overview-value" id="total-products">0 s·∫£n ph·∫©m</div>
                </div>
                <div class="overview-card">
                    <h3>T·ªïng gi√° tr·ªã t·ªìn kho</h3>
                    <div class="overview-value" id="total-inventory">0 ‚Ç´</div>
                </div>
                <div class="overview-card">
                    <h3>T·ªïng gi√° tr·ªã ƒë√£ b√°n</h3>
                    <div class="overview-value" id="total-sales">0 ‚Ç´</div>
                </div>
                <div class="overview-card">
                    <h3>T·ªïng s·ªë l∆∞·ª£ng ƒë√£ nh·∫≠p</h3>
                    <div class="overview-value" id="total-imports">0 s·∫£n ph·∫©m</div>
                </div>
            </div>
        </section>

        <!-- Menu Gi√° B√°n -->
        <section id="gia-ban" class="menu-section">
            <h2 class="section-title">üí∞ GI√Å B√ÅN</h2>
            <div class="price-management">
                <div class="price-form">
                    <table class="price-table" id="price-table">
                        <thead>
                            <tr>
                                <th>Size</th>
                                <th>ƒêP Nam</th>
                                <th>ƒêP N·ªØ</th>
                                <th>Th·ªÉ d·ª•c</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <button class="btn btn-primary" onclick="saveAllPrices()">L∆∞u t·∫•t c·∫£ gi√°</button>
                </div>
                <div class="price-history">
                    <h3>L·ªãch s·ª≠ thay ƒë·ªïi gi√°</h3>
                    <div id="price-history-list"></div>
                </div>
            </div>
        </section>

        <!-- Menu Nh·∫≠p H√†ng -->
        <section id="nhap-hang" class="menu-section">
            <h2 class="section-title">üì• NH·∫¨P H√ÄNG</h2>
            <div class="import-form">
                <div class="import-grid" id="import-grid"></div>
                <button class="btn btn-primary" onclick="confirmImport()">X√°c nh·∫≠n nh·∫≠p h√†ng</button>
            </div>
        </section>

        <!-- Menu B√°n H√†ng -->
        <section id="ban-hang" class="menu-section">
            <h2 class="section-title">üõçÔ∏è B√ÅN H√ÄNG</h2>
            <div class="container">
                <div class="products-grid" id="products-grid"></div>
                <div class="cart-section">
                    <div class="cart-header">
                        <h3>Gi·ªè h√†ng (<span id="cart-count">0</span>)</h3>
                        <button class="btn btn-danger" onclick="clearCart()">X√≥a t·∫•t c·∫£</button>
                    </div>
                    <div class="cart-items" id="cart-items">
                        <div style="text-align: center; color: #999; padding: 20px 0;">Gi·ªè h√†ng tr·ªëng</div>
                    </div>
                    <div class="cart-footer">
                        <div class="cart-total">T·ªïng c·ªông: <span id="cart-total-amount">0</span> ‚Ç´</div>
                        <button class="btn btn-success" onclick="confirmSale()" id="confirm-sale-btn" style="width:100%;margin-top:10px;">X√°c nh·∫≠n b√°n h√†ng</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Menu T·ªìn Kho -->
        <section id="ton-kho" class="menu-section">
            <div class="section-header">
                <h2 class="section-title">üì¶ T·ªíN KHO</h2>
                <button class="delete-all-btn" onclick="xoaTatCaTonKho()">X√≥a t·∫•t c·∫£</button>
            </div>
            <div class="inventory-table">
                <table class="data-table" id="inventory-table">
                    <thead>
                        <tr>
                            <th>S·∫£n ph·∫©m</th>
                            <th>ƒê√£ nh·∫≠p</th>
                            <th>ƒê√£ b√°n</th>
                            <th>T·ªìn kho</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Menu L·ªãch S·ª≠ Nh·∫≠p -->
        <section id="lich-su-nhap" class="menu-section">
            <div class="section-header">
                <h2 class="section-title">üìã L·ªäCH S·ª¨ NH·∫¨P H√ÄNG</h2>
                <button class="delete-all-btn" onclick="xoaTatCaLichSuNhap()">X√≥a t·∫•t c·∫£</button>
            </div>
            <div class="data-table-wrapper">
                <div id="import-history"></div>
            </div>
        </section>

        <!-- Menu L·ªãch S·ª≠ B√°n -->
        <section id="lich-su-ban" class="menu-section">
            <div class="section-header">
                <h2 class="section-title">üìä L·ªäCH S·ª¨ B√ÅN H√ÄNG</h2>
                <button class="delete-all-btn" onclick="xoaTatCaLichSuBan()">X√≥a t·∫•t c·∫£</button>
            </div>
            <div class="data-table-wrapper">
                <div id="sales-history"></div>
            </div>
        </section>
    </div>

    <!-- Modal -->
    <div class="modal" id="sale-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-product-name"></h3>
                <p class="modal-subtitle">T·ªìn kho: <span id="modal-current-stock">0</span> s·∫£n ph·∫©m</p>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="sale-quantity">S·ªë l∆∞·ª£ng</label>
                <input type="number" class="form-input" id="sale-quantity" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng" min="1">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="sale-note">Ghi ch√∫ (tu·ª≥ ch·ªçn)</label>
                <textarea class="form-input form-textarea" id="sale-note" placeholder="Th√™m ghi ch√∫ cho ƒë∆°n h√†ng"></textarea>
            </div>
            
            <div class="error-message" id="stock-error"></div>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">H·ªßy</button>
                <button class="btn btn-primary" onclick="addToCart()">Th√™m v√†o gi·ªè</button>
            </div>
        </div>
    </div>

            <script>
            // --- C·∫§U H√åNH FIREBASE ---
            const firebaseConfig = {
                apiKey: "AIzaSyDdW_GqpCpOLdwKWOKwPhdyMCtrW3Ynqek",
                authDomain: "uniform-management-dfa0e.firebaseapp.com",
                projectId: "uniform-management-dfa0e",
                storageBucket: "uniform-management-dfa0e.firebasestorage.app",
                messagingSenderId: "519882415963",
                appId: "1:519882415963:web:adda312cacf3151bc7047e"
            };

            let db;

            function loadFirebase() {
                return new Promise((resolve, reject) => {
                    if (typeof firebase === 'undefined') {
                        const script = document.createElement('script');
                        script.src = 'https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js';
                        script.onload = () => {
                            const script2 = document.createElement('script');
                            script2.src = 'https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js';
                            script2.onload = () => {
                                firebase.initializeApp(firebaseConfig);
                                db = firebase.firestore();
                                resolve();
                            };
                            script2.onerror = reject;
                            document.head.appendChild(script2);
                        };
                        script.onerror = reject;
                        document.head.appendChild(script);
                    } else {
                        firebase.initializeApp(firebaseConfig);
                        db = firebase.firestore();
                        resolve();
                    }
                });
            }

            // --- D·ªÆ LI·ªÜU ·ª®NG D·ª§NG ---
            let products = [];
            let cart = [];
            let salesHistory = [];
            let importHistory = [];
            let priceHistory = [];
            let currentProduct = null;

            document.addEventListener('DOMContentLoaded', function() {
                loadFirebase().then(() => {
                    loadDataFromFirebase();
                }).catch(error => {
                    console.error('L·ªói t·∫£i Firebase:', error);
                    showNotification('L·ªói k·∫øt n·ªëi Firebase', 'error');
                });
            });

            // --- FIREBASE ---
            async function loadDataFromFirebase() {
                try {
                    showNotification('ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Firebase...', 'info');
                    const docRef = db.collection("uniformData").doc("main");
                    const docSnap = await docRef.get();
                    if (docSnap.exists) {
                        const data = docSnap.data();
                        products = data.products || [];
                        salesHistory = data.salesHistory || [];
                        importHistory = data.importHistory || [];
                        priceHistory = data.priceHistory || [];
                    } else {
                        await initSampleData();
                        return;
                    }
                    updateDashboardTotals();
                    updateOverview();
                    showMenu('tong-quan');
                    showNotification('T·∫£i d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
                } catch (error) {
                    console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                    showNotification('L·ªói khi t·∫£i d·ªØ li·ªáu: ' + error.message, 'error');
                }
            }

            async function saveDataToFirebase() {
                try {
                    await db.collection("uniformData").doc("main").set({
                        products, salesHistory, importHistory, priceHistory,
                        lastUpdated: new Date().toISOString()
                    });
                    return true;
                } catch (error) {
                    showNotification('L·ªói khi l∆∞u d·ªØ li·ªáu: ' + error.message, 'error');
                    return false;
                }
            }

            // --- KH·ªûI T·∫†O D·ªÆ LI·ªÜU M·∫™U ---
            async function initSampleData() {
                products = [
                    // Nam
                    ...[2,3,4,5,6,7,8,10].map(size => ({
                        id: size, name: `ƒêP Nam ${size}`, type: "nam", size, price: 90000, stock: 0, imported: 0, sold: 0
                    })),
                    // N·ªØ
                    ...[2,3,4,5,6,7,8,10].map(size => ({
                        id: 100+size, name: `ƒêP N·ªØ ${size}`, type: "nu", size, price: 90000, stock: 0, imported: 0, sold: 0
                    })),
                    // Th·ªÉ d·ª•c
                    ...[2,3,4,5,6,7,8,10].map(size => ({
                        id: 200+size, name: `Th·ªÉ d·ª•c ${size}`, type: "the_duc", size, price: 55000, stock: 0, imported: 0, sold: 0
                    })),
                ];
                salesHistory = [];
                importHistory = [];
                priceHistory = [];
                await saveDataToFirebase();
                showNotification('ƒê√£ kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u th√†nh c√¥ng!', 'success');
                updateDashboardTotals();
                updateOverview();
                showMenu('tong-quan');
            }

            // --- HI·ªÇN TH·ªä MENU ---
            function showMenu(menuId) {
                document.querySelectorAll('.menu-section').forEach(x => x.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(menuId).classList.add('active');
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    if (btn.textContent.trim() === getButtonText(menuId)) btn.classList.add('active');
                });
                switch(menuId) {
                    case 'tong-quan': updateOverview(); break;
                    case 'gia-ban': initPriceManagement(); break;
                    case 'nhap-hang': initImportForm(); break;
                    case 'ban-hang': initProductsGrid(); break;
                    case 'ton-kho': initInventoryTable(); break;
                    case 'lich-su-nhap': initImportHistory(); break;
                    case 'lich-su-ban': initSalesHistory(); break;
                }
            }

            function getButtonText(menuId) {
                return ({
                    'tong-quan': 'T·ªïng Quan', 'gia-ban': 'Gi√° B√°n', 'nhap-hang': 'Nh·∫≠p H√†ng',
                    'ban-hang': 'B√°n H√†ng', 'ton-kho': 'T·ªìn Kho', 'lich-su-nhap': 'L·ªãch S·ª≠ Nh·∫≠p', 'lich-su-ban': 'L·ªãch S·ª≠ B√°n'
                })[menuId];
            }

            // --- T·ªîNG QUAN ---
            function updateOverview() {
                const totalProducts = products.reduce((sum, p) => sum + p.stock, 0);
                const totalValue = products.reduce((sum, p) => sum + (p.stock * p.price), 0);
                const totalSales = salesHistory.reduce((sum, sale) => sum + sale.totalAmount, 0);
                const totalImports = importHistory.reduce((sum, imp) => sum + imp.total, 0);
                document.getElementById('total-products').textContent = totalProducts + ' s·∫£n ph·∫©m';
                document.getElementById('total-inventory').textContent = totalValue.toLocaleString() + '‚Ç´';
                document.getElementById('total-sales').textContent = totalSales.toLocaleString() + '‚Ç´';
                document.getElementById('total-imports').textContent = totalImports + ' s·∫£n ph·∫©m';
            }

            // --- MENU B√ÅN H√ÄNG ---
            function initProductsGrid() {
                const grid = document.getElementById('products-grid');
                grid.innerHTML = '';
                products.forEach(product => {
                    const div = document.createElement('div');
                    div.className = `product-item product-${product.type}`;
                    div.innerHTML = `<div>${product.name}</div><div class="product-stock">T·ªìn: ${product.stock}</div>`;
                    div.onclick = () => openSaleModal(product);
                    grid.appendChild(div);
                });
                updateCartDisplay();
            }

            function openSaleModal(product) {
                currentProduct = product;
                document.getElementById('modal-product-name').textContent = product.name;
                document.getElementById('modal-current-stock').textContent = product.stock;
                document.getElementById('sale-quantity').value = '';
                document.getElementById('sale-note').value = '';
                document.getElementById('stock-error').style.display = 'none';
                document.getElementById('sale-modal').style.display = 'block';
                setTimeout(() => document.getElementById('sale-quantity').focus(), 100);
            }

            function closeModal() {
                document.getElementById('sale-modal').style.display = 'none';
                currentProduct = null;
            }

            function addToCart() {
                const quantity = parseInt(document.getElementById('sale-quantity').value);
                const note = document.getElementById('sale-note').value;
                if (!quantity || quantity <= 0) {
                    showNotification('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng h·ª£p l·ªá', 'error');
                    return;
                }
                if (quantity > currentProduct.stock) {
                    document.getElementById('stock-error').textContent = 'S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho';
                    document.getElementById('stock-error').style.display = 'block';
                    return;
                }
                const idx = cart.findIndex(item => item.productId === currentProduct.id && item.note === note);
                if (idx !== -1) {
                    cart[idx].quantity += quantity;
                    cart[idx].total = cart[idx].quantity * currentProduct.price;
                } else {
                    cart.push({
                        productId: currentProduct.id,
                        productName: currentProduct.name,
                        quantity,
                        price: currentProduct.price,
                        note,
                        total: quantity * currentProduct.price
                    });
                }
                updateCartDisplay();
                closeModal();
                showNotification('ƒê√£ th√™m v√†o gi·ªè h√†ng!');
            }

            function updateCartDisplay() {
                const cartItems = document.getElementById('cart-items');
                const cartCount = document.getElementById('cart-count');
                const cartTotal = document.getElementById('cart-total-amount');
                const confirmBtn = document.getElementById('confirm-sale-btn');
                cartItems.innerHTML = '';
                if (cart.length === 0) {
                    cartItems.innerHTML = '<div style="text-align: center; color: #999; padding: 20px 0;">Gi·ªè h√†ng tr·ªëng</div>';
                    confirmBtn.disabled = true;
                } else {
                    let totalAmount = 0;
                    cart.forEach((item, i) => {
                        totalAmount += item.total;
                        const div = document.createElement('div');
                        div.className = 'cart-item';
                        div.innerHTML = `
                            <div>
                                <div><strong>${item.productName}</strong></div>
                                <div>${item.quantity} √ó ${item.price.toLocaleString()}‚Ç´</div>
                                ${item.note ? `<div><small>${item.note}</small></div>` : ''}
                            </div>
                            <div>
                                <strong>${item.total.toLocaleString()}‚Ç´</strong>
                                <button onclick="removeFromCart(${i})" style="background:none;border:none;color:red;cursor:pointer;margin-left:10px;">√ó</button>
                            </div>
                        `;
                        cartItems.appendChild(div);
                    });
                    confirmBtn.disabled = false;
                    cartTotal.textContent = totalAmount.toLocaleString();
                }
                cartCount.textContent = cart.length;
            }

            function removeFromCart(index) {
                cart.splice(index, 1);
                updateCartDisplay();
                showNotification('ƒê√£ x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng');
            }

            function clearCart() {
                if (cart.length === 0) {
                    showNotification('Gi·ªè h√†ng tr·ªëng!', 'error');
                    return;
                }
                cart = [];
                updateCartDisplay();
                showNotification('ƒê√£ x√≥a to√†n b·ªô gi·ªè h√†ng');
            }

            async function confirmSale() {
                if (cart.length === 0) {
                    showNotification('Gi·ªè h√†ng tr·ªëng!', 'error');
                    return;
                }
                const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
                showNotification(`ƒêang x·ª≠ l√Ω b√°n ${cart.length} s·∫£n ph·∫©m...`, 'info');
                const sale = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString('vi-VN'),
                    items: [...cart],
                    totalAmount
                };
                salesHistory.push(sale);
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        product.stock -= item.quantity;
                        product.sold += item.quantity;
                    }
                });
                cart = [];
                updateCartDisplay();
                const success = await saveDataToFirebase();
                if (success) {
                    updateDashboardTotals();
                    updateOverview();
                    updateProductGridStock();
                    showNotification(`‚úÖ B√°n h√†ng th√†nh c√¥ng! T·ªïng: ${totalAmount.toLocaleString()}‚Ç´`, 'success');
                    setTimeout(() => showMenu('lich-su-ban'), 1000);
                }
            }

            // --- GI√Å B√ÅN ---
            function initPriceManagement() {
                const tableBody = document.querySelector('#price-table tbody');
                tableBody.innerHTML = '';
                const sizes = [2,3,4,5,6,7,8,10];
                sizes.forEach(size => {
                    const row = document.createElement('tr');
                    const nam = products.find(p => p.type==='nam' && p.size===size);
                    const nu = products.find(p => p.type==='nu' && p.size===size);
                    const td = products.find(p => p.type==='the_duc' && p.size===size);
                    row.innerHTML = `
                        <td><strong>${size}</strong></td>
                        <td><input type="number" class="price-input" value="${nam.price}" data-product="${nam.id}"></td>
                        <td><input type="number" class="price-input" value="${nu.price}" data-product="${nu.id}"></td>
                        <td><input type="number" class="price-input" value="${td.price}" data-product="${td.id}"></td>
                    `;
                    tableBody.appendChild(row);
                });
                updatePriceHistory();
            }

            async function saveAllPrices() {
                const inputs = document.querySelectorAll('.price-input');
                let hasChange = false;
                inputs.forEach(input => {
                    const productId = parseInt(input.dataset.product);
                    const newPrice = parseInt(input.value);
                    const product = products.find(p => p.id === productId);
                    if (product && newPrice !== product.price) {
                        priceHistory.push({
                            product: product.name,
                            oldPrice: product.price,
                            newPrice,
                            timestamp: new Date().toLocaleString('vi-VN')
                        });
                        product.price = newPrice;
                        hasChange = true;
                    }
                });
                if (hasChange) {
                    await saveDataToFirebase();
                    showNotification('ƒê√£ c·∫≠p nh·∫≠t gi√° th√†nh c√¥ng!');
                    updatePriceHistory();
                    updateDashboardTotals();
                    updateOverview();
                } else {
                    showNotification('Kh√¥ng c√≥ thay ƒë·ªïi n√†o ƒë·ªÉ l∆∞u!', 'info');
                }
            }

            function updatePriceHistory() {
                const historyList = document.getElementById('price-history-list');
                historyList.innerHTML = '';
                if (priceHistory.length === 0) {
                    historyList.innerHTML = '<p style="text-align:center;color:#999;">Ch∆∞a c√≥ l·ªãch s·ª≠ thay ƒë·ªïi gi√°</p>';
                    return;
                }
                priceHistory.slice().reverse().forEach(history => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div><strong>${history.timestamp}</strong></div>
                        <div>${history.product}: ${history.oldPrice.toLocaleString()}‚Ç´ ‚Üí ${history.newPrice.toLocaleString()}‚Ç´</div>
                    `;
                    historyList.appendChild(div);
                });
            }

            // --- NH·∫¨P H√ÄNG ---
            function initImportForm() {
                const importGrid = document.getElementById('import-grid');
                importGrid.innerHTML = '';
                products.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'import-item';
                    item.innerHTML = `
                        <div><strong>${product.name}</strong></div>
                        <input type="number" class="import-input" data-product="${product.id}" placeholder="0" min="0">
                    `;
                    importGrid.appendChild(item);
                });
            }

            async function confirmImport() {
                const inputs = document.querySelectorAll('.import-input');
                let importData = [];
                let totalQuantity = 0;
                inputs.forEach(input => {
                    const quantity = parseInt(input.value) || 0;
                    if (quantity > 0) {
                        const productId = parseInt(input.dataset.product);
                        const product = products.find(p => p.id === productId);
                        importData.push(`${product.name}: ${quantity}`);
                        totalQuantity += quantity;
                        product.stock += quantity;
                        product.imported += quantity;
                    }
                });
                if (importData.length === 0) {
                    showNotification('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m!', 'error');
                    return;
                }
                importHistory.push({
                    products: importData,
                    total: totalQuantity,
                    timestamp: new Date().toLocaleString('vi-VN')
                });
                inputs.forEach(input => input.value = '');
                const success = await saveDataToFirebase();
                if (success) {
                    updateDashboardTotals();
                    updateOverview();
                    showNotification(`Nh·∫≠p h√†ng th√†nh c√¥ng! T·ªïng: ${totalQuantity} s·∫£n ph·∫©m`);
                    setTimeout(() => showMenu('lich-su-nhap'), 1000);
                }
            }

            // --- T·ªíN KHO ---
            function initInventoryTable() {
                const tableBody = document.querySelector('#inventory-table tbody');
                tableBody.innerHTML = '';
                products.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${product.name}</strong></td>
                        <td>${product.imported}</td>
                        <td>${product.sold}</td>
                        <td><strong>${product.stock}</strong></td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // --- L·ªäCH S·ª¨ NH·∫¨P ---
            function initImportHistory() {
                const historyContainer = document.getElementById('import-history');
                historyContainer.innerHTML = '';
                if (importHistory.length === 0) {
                    historyContainer.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">Ch∆∞a c√≥ l·ªãch s·ª≠ nh·∫≠p h√†ng</p>';
                    return;
                }
                const table = document.createElement('table');
                table.className = 'data-table';
                table.innerHTML = `
                    <thead>
                        <tr><th>Th·ªùi gian</th><th>S·∫£n ph·∫©m</th><th>S·ªë l∆∞·ª£ng</th></tr>
                    </thead><tbody></tbody>
                `;
                const tbody = table.querySelector('tbody');
                importHistory.slice().reverse().forEach(importItem => {
                    importItem.products.forEach((product, i) => {
                        const [name, quantity] = product.split(':');
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${i === 0 ? importItem.timestamp : ''}</td>
                            <td>${name.trim()}</td>
                            <td>${quantity.trim()}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
                historyContainer.appendChild(table);
            }

            // --- L·ªäCH S·ª¨ B√ÅN ---
            function initSalesHistory() {
                const historyContainer = document.getElementById('sales-history');
                historyContainer.innerHTML = '';
                if (salesHistory.length === 0) {
                    historyContainer.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">Ch∆∞a c√≥ l·ªãch s·ª≠ b√°n h√†ng</p>';
                    return;
                }
                const table = document.createElement('table');
                table.className = 'data-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Th·ªùi gian</th><th>S·∫£n ph·∫©m</th><th>Gi√° b√°n</th>
                            <th>S·ªë l∆∞·ª£ng</th><th>Th√†nh ti·ªÅn</th><th>Ghi ch√∫</th><th>T·ªïng ƒë∆°n h√†ng</th>
                        </tr>
                    </thead><tbody></tbody>
                `;
                const tbody = table.querySelector('tbody');
                salesHistory.slice().reverse().forEach(sale => {
                    sale.items.forEach((item, i) => {
                        const tr = document.createElement('tr');
                        const totalCell = i === 0 ?
                            `<td rowspan="${sale.items.length}" style="vertical-align: middle; background: #f8f9fa;">
                                <strong>${sale.totalAmount.toLocaleString()}‚Ç´</strong>
                            </td>` : '<td></td>';
                        tr.innerHTML = `
                            <td>${i === 0 ? sale.timestamp : ''}</td>
                            <td>${item.productName}</td>
                            <td>${item.price.toLocaleString()}‚Ç´</td>
                            <td>${item.quantity}</td>
                            <td>${item.total.toLocaleString()}‚Ç´</td>
                            <td>${item.note || ''}</td>
                            ${totalCell}
                        `;
                        tbody.appendChild(tr);
                    });
                });
                historyContainer.appendChild(table);
            }

            // --- DASHBOARD ---
            function updateDashboardTotals() {
                // T√≠nh t·ªïng t·ªìn kho theo ƒë√∫ng gi√°
                const totalUniform = products.filter(p => p.type === 'nam' || p.type === 'nu')
                                            .reduce((sum, p) => sum + p.stock, 0);
                const totalPE = products.filter(p => p.type === 'the_duc')
                                        .reduce((sum, p) => sum + p.stock, 0);
                const totalInventoryValue = (totalUniform * 90000) + (totalPE * 55000);

                // T√≠nh t·ªïng gi√° tr·ªã b√°n
                const totalSalesValue = salesHistory.reduce((sum, sale) => sum + sale.totalAmount, 0);

                document.getElementById('total-inventory-value').textContent = totalInventoryValue.toLocaleString() + '‚Ç´';
                document.getElementById('total-sales-value').textContent = totalSalesValue.toLocaleString() + '‚Ç´';
            }

            function updateProductGridStock() {
                document.querySelectorAll('.product-item').forEach(item => {
                    const name = item.querySelector('div:first-child')?.textContent.trim();
                    const prod = products.find(p => p.name === name);
                    if (prod) {
                        const stockElem = item.querySelector('.product-stock');
                        if (stockElem) stockElem.textContent = `T·ªìn: ${prod.stock}`;
                    }
                });
            }

            // --- X√ìA T·∫§T C·∫¢ ---
            async function xoaTatCaTonKho() {
                products.forEach(product => { product.stock = 0; product.imported = 0; product.sold = 0; });
                await saveDataToFirebase();
                initInventoryTable();
                updateDashboardTotals();
                updateOverview();
                updateProductGridStock();
                showNotification('ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu t·ªìn kho!');
            }

            async function xoaTatCaLichSuNhap() {
                importHistory = [];
                await saveDataToFirebase();
                initImportHistory();
                updateDashboardTotals();
                updateOverview();
                showNotification('ƒê√£ x√≥a t·∫•t c·∫£ l·ªãch s·ª≠ nh·∫≠p h√†ng!');
            }

            async function xoaTatCaLichSuBan() {
                salesHistory = [];
                await saveDataToFirebase();
                initSalesHistory();
                updateDashboardTotals();
                updateOverview();
                showNotification('ƒê√£ x√≥a t·∫•t c·∫£ l·ªãch s·ª≠ b√°n h√†ng!');
            }

            // --- TH√îNG B√ÅO ---
            function showNotification(message, type = 'success') {
                let notification = document.getElementById('notification');
                if (!notification) {
                    notification = document.createElement('div');
                    notification.id = 'notification';
                    document.body.appendChild(notification);
                }
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                setTimeout(() => notification.classList.remove('show'), 3000);
            }

            // --- ƒê√ìNG MODAL KHI CLICK RA NGO√ÄI ---
            window.onclick = function(event) {
                if (event.target === document.getElementById('sale-modal')) closeModal();
            }
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') closeModal();
            });
</script>
</body>
</html>
